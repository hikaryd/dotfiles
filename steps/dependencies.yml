- shell:
    - command: |
        if ! command -v brew >/dev/null 2>&1; then
          echo "Homebrew is not installed. Skipping Brewfile."
          exit 0
        fi
        echo "Installing packages from Brewfile ..."
        brew bundle --file Brewfile
      description: Install Homebrew packages via Brewfile
      stdout: true
      stderr: true
    - command: |
        if ! command -v rustup >/dev/null 2>&1; then
          echo "Installing Rust with nightly toolchain..."
          curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain nightly --profile default
          echo "Rust installed successfully."
        else
          echo "Rustup already installed. Ensuring nightly toolchain is set..."
          rustup default nightly
        fi
      description: Install Rust with nightly toolchain
      stdout: true
      stderr: true
    - command: |
        if python3 -c "import yaml" 2>/dev/null; then
          echo "PyYAML already installed"
        else
          pip3 install pyyaml --break-system-packages
        fi
      description: Install PyYAML for Python
      stdout: true
      stderr: true
    - command: |
        if command -v rtk >/dev/null 2>&1; then
          echo "rtk already installed"
        else
          echo "Installing rtk..."
          curl -fsSL https://raw.githubusercontent.com/rtk-ai/rtk/refs/heads/master/install.sh | sh
          rtk init --global
        fi
      description: Install rtk (Rust Token Killer)
      stdout: true
      stderr: true
